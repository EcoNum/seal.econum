---
title: "Importation, conversion, correction et analyse des données du seal aa3 du laboratoire d'econum"
author: "Engels Guyliann & Raphael Conotte"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Importation, conversion, correction et analyse des données du seal aa3 du laboratoire d'econum}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

La laboratoire d'Ecologie Numérique des Milieux Aquatiques de l'Université de Mons utilise un autoanalyseur **seal AA3** dans ces recherces. Cet instrument permet de quantifier avec une grande précision :

- azote organique
- phosphore organique
- azote inorganique (nitrite, nitrate, ammonium)
- azote inorganique (phosphate)

L'instrument utilise deux méthodes pour analyser les différents composés ci-dessus. La première mesure les phosphotes, les nitrates et les ammonium et la seconde méthode mesure l'azote total, le phosphore total et les nitrites.

Le seal AA3 renvoit des fichiers textes comme le montre le tableau ci-dessous. Le nom des fichier est toujours la date inversée suivi d'une lettre (ex : 181009A, concernne une analyse fait le 9 octobre 2018)

```{r}
aa3_txt <- "../inst/extra_data/181009A.TXT"

aa3 <- readr::read_delim(file = aa3_txt, 
                            delim = ";",
                            col_names = FALSE,
                            col_types = readr::cols( .default = "c"),
                            locale = readr::locale(encoding = "LATIN1")) # particulary
knitr::kable(aa3[c(0:18, 22:25, 29:33), ], align = "c", caption = "Extrait d'un tableau de données fourni par le seal AA3")
```

Ce fichier peut être divisé en deux parties distinctes. La première a pour but de fournir un ensemble de métadonnées sur l'anlyse et la seconde partie renvoit un tableau de données sur les échantillons analysés (courbe de calibration et échantillons de lié à une expérience).

Le préambule de ce document contient des informations importantes que l’on ne peut dissocier du tableau de données afin de comprendre les résultats.

```{r}
knitr::kable(aa3[0:13, ], align = "c", caption = "Extrait d'un tableau de données fourni par le seal AA3")
```

La seconde partie du document comprend les échantillons analysés aussi bien de calibrations que les échantillons liés à l'expérience. 

```{r}
knitr::kable(aa3[14:25, ], align = "c", caption = "Extrait d'un tableau de données fourni par le seal AA3")
```

Malgré le préambule et le tableau de données des informations essentielles sont manquantes. Pour annoter l’échantillon qui est dosé par l’instrument, on peut encoder uniquement ces références dans la colonnes Sample ID. Le nombre de caractères encodables est limité.

Les informations manquantes sont :

- le nom du projet ou de l’expérience réalisée
- l’heure de l’échantillonnage 
- le nom de l’expérimentateur (personne qui prélève l’échantillon)

Il est dès lors indispensable de proposer des outils permettant de combiner ces manquements.

## Importation et Conversion du fichier texte du Seal AA3

## Principe

Tout d’abord, il est intéressant d’encoder proprement les données. Il faut de plus pallier aux manquements cités ci-dessus, la solutions la plus simple est de rédiger un second fichier sous la forme d’un template conçu à cet effet afin de venir ajouter l’ensemble des informations manquantes. Ce second document est d’une importance capitale afin de connaitre la provenance d’un échantillon. Pour ce faire, la colonne sample.id va servir de lien entre les deux tableaux. Le nom donné au second ficier est le même que celui du premier avec une extension différente.

```{r}
library(seal.econum)
# importation de données exemples
aa3_txt <- "../inst/extra_data/181009A.TXT"
aa3_xlsx <- "../inst/extra_data/181009A.xlsx"
# utilisation de la fonction d'importation et de conversion des données
aa3_combine <- convert_aa3(file_aa3_txt = aa3_txt, file_aa3_xlsx = aa3_xlsx)
```

Le jeu de données se présente de la manière suivante :

```{r}
knitr::kable(aa3_combine)
```

Ce dernier comprend un ensemble d'attribus lié aux métadonnées du fichier au format txt.

```{r}
attributes(aa3_combine)
```

## Visualisation de la calibration et correction

Une fois les échantillons analysés et convertis, il faut maintenant valider l'analyer en s'assurant du bon déroulant de cette dernière d'un point de vu technique.

### Visualisation des calibrations

La fonction calb_aa3 n'utilise qu'un seul argument, l'objet formé suite à la conversion des données de l'autoanalyseur.

```{r}
calb <- calb_aa3(aa3_combine)
```
L'objet calb comprend différents élements : 

```{r}
attributes(calb)
```

#### calbbd

Cet objet comprend le tableau de données composé uniquement des données lié à la calibration.

```{r}
calb$calbdb
```

Ce dernier a pour vocation d'être facilement sauvegardé sur une base de données ou en local dans un fichier de données. 

#### regression

Cet objet comprend un résumé sous la forme de tableau des régressions linéaires.

```{r}
calb$regression
```

Cet objet comprend les graphiques lié aux régressions linéaires.

```{r}
calb$graph
```

Cet objet comprend les échantillons liés uniquement à l'expérience.

```{r}
calb$sampdb
```

## Correction des données de calibration

Les données de calibration peuvent être eronée et il faut nécéssairement que ces dernières soit validés. Pour ce faire, la fonction calb_correction_aa3() a été mise au point.

```{r}
#calb_corr <- calb_correction_aa3(aa3 = calb, 
#                                 filter_list = list(NH4 =c(0.1, 0.5)))
```


Après avoir validé les différentes étapes on peut sauvegarder les données de calibration et les échantillons dans une autres. 

## Compilation des données des deux méthodes

Les prélèvements sont 
